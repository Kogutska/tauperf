#!/usr/bin/env python
# python imports
import os
# root/rootpy imports
import ROOT
from rootpy.plotting import (
    Canvas, Hist, HistStack, 
    Efficiency, F1, Legend)
from rootpy.plotting.utils import draw
from rootpy.plotting.style import set_style, get_style
from rootpy.extern.tabulartext import PrettyTable

from tauperf.analysis import Analysis
from tauperf.variables import VARIABLES, get_label
from tauperf.categories import Category_1P_HLT, Category_MP_HLT
from tauperf.default import CUT_1P, CUT_MP
from tauperf.plotting import draw_efficiency
from tauperf.plotting.templates import rejection_linear
style = get_style('ATLAS', shape='rect')
style.SetPadRightMargin(0.10)
style.cd()



table = PrettyTable(['menu', 'mu', 'ntrack', 'eff_s', '1-eff_b'])
ana = Analysis(ntuple_path='/Users/quentin/Desktop/sandbox')

vars = {'pt': VARIABLES['pt'], 'eta': VARIABLES['eta'], 'npv': VARIABLES['npv']}


for category, cut in zip((Category_1P_HLT, Category_MP_HLT), (CUT_1P, CUT_MP)):
    cut = 'hlt_bdt_score>{0}'.format(cut)
    hist_samples = ana.get_hist_samples_array(vars, 'hlt', category)
    hist_samples_cut = ana.get_hist_samples_array(vars, 'hlt', category, cut)
    for var in hist_samples:
        eff_s = Efficiency(
            hist_samples_cut[var]['tau'], hist_samples[var]['tau'])
        eff_s.title = hist_samples_cut[var]['tau'].title
        eff_b = Efficiency(
            hist_samples_cut[var]['jet'], hist_samples[var]['jet'])
        rej_b = rejection_linear(eff_b)
        rej_b.title = hist_samples_cut[var]['jet'].title
        
        c = draw_efficiency(eff_s, rej_b, var, category) 
        c.SaveAs('toto_{0}_{1}.png'.format(var, category.name))
        
        
